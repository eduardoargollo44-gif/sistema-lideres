<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Acompanhamento de LÃ­deres v3.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header h1 { color: #333; margin-bottom: 10px; }
        .buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #48bb78; color: white; }
        .btn-info { background: #4299e1; color: white; }
        .btn-warning { background: #ed8936; color: white; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card h3 { color: #333; margin-bottom: 15px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #333; font-weight: bold; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .alert { padding: 15px; border-radius: 5px; margin-bottom: 15px; display: none; }
        .alert.active { display: block; }
        .alert.success { background: #c6f6d5; color: #22543d; }
        .alert.error { background: #fed7d7; color: #742a2a; }
        .chart-container { position: relative; height: 300px; margin-top: 20px; }
        .empty { color: #999; text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“Š Sistema de Acompanhamento de LÃ­deres v3.0</h1>
            <div class="buttons">
                <button class="btn-primary" onclick="abrirModal('modalAdicionar')">+ Adicionar LÃ­der</button>
                <button class="btn-primary" onclick="abrirModal('modalReuniao')">+ Registrar ReuniÃ£o</button>
                <button class="btn-success" onclick="abrirModal('modalImportar')">ðŸ“¥ Importar CSV</button>
                <button class="btn-warning" onclick="exportarCSV()">ðŸ“¥ Exportar CSV</button>
                <button class="btn-info" onclick="sincronizarGoogle()">ðŸ”„ Sincronizar Google Sheets</button>
            </div>
        </div>

        <div id="alerta" class="alert"></div>

        <div class="grid">
            <div class="card">
                <h3>ðŸ“Š EstatÃ­sticas</h3>
                <p>Total de LÃ­deres: <strong id="totalLideres">0</strong></p>
                <p>ReuniÃµes: <strong id="totalReunioes">0</strong></p>
                <p>PresenÃ§a MÃ©dia: <strong id="presencaMedia">0%</strong></p>
            </div>

            <div class="card">
                <h3>ðŸ”— SincronizaÃ§Ã£o</h3>
                <div id="statusSync">NÃ£o configurado</div>
            </div>
        </div>

        <div class="card">
            <h3>ðŸ“‹ LÃ­deres</h3>
            <div id="lidereslista" class="empty">Nenhum lÃ­der cadastrado</div>
        </div>

        <div class="card">
            <h3>ðŸ“Š GrÃ¡fico de PresenÃ§a</h3>
            <div class="chart-container">
                <canvas id="presencaChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Modais -->
    <div id="modalAdicionar" class="modal">
        <div class="modal-content">
            <h2>Adicionar LÃ­der</h2>
            <form onsubmit="adicionarLider(event)">
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="nomeLider" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="emailLider" required>
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="text" id="telefoneLider" required>
                </div>
                <div class="form-group">
                    <label>Data de InÃ­cio</label>
                    <input type="date" id="dataInicioLider" required>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">Salvar</button>
                <button type="button" class="btn-warning" style="width: 100%; margin-top: 10px;" onclick="fecharModal('modalAdicionar')">Fechar</button>
            </form>
        </div>
    </div>

    <div id="modalReuniao" class="modal">
        <div class="modal-content">
            <h2>Registrar ReuniÃ£o</h2>
            <form onsubmit="adicionarReuniao(event)">
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" id="dataReuniao" required>
                </div>
                <div class="form-group">
                    <label>LÃ­der</label>
                    <select id="liderReuniao" required>
                        <option value="">Selecione</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Presente?</label>
                    <select id="presenteReuniao" required>
                        <option value="">Selecione</option>
                        <option value="sim">Sim</option>
                        <option value="nao">NÃ£o</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">Salvar</button>
                <button type="button" class="btn-warning" style="width: 100%; margin-top: 10px;" onclick="fecharModal('modalReuniao')">Fechar</button>
            </form>
        </div>
    </div>

    <div id="modalImportar" class="modal">
        <div class="modal-content">
            <h2>Importar CSV</h2>
            <div class="form-group">
                <label>Selecione o arquivo CSV</label>
                <input type="file" id="csvFile" accept=".csv" onchange="importarCSV(event)">
                <button type="button" class="btn-primary" style="width: 100%; margin-top: 10px;" onclick="document.getElementById('csvFile').click();">Escolher Arquivo</button>
            </div>
            <button type="button" class="btn-warning" style="width: 100%; margin-top: 10px;" onclick="fecharModal('modalImportar')">Fechar</button>
        </div>
    </div>

    <script>
        let dados = { lideres: [], reunioes: [] };
        let sheetdbUrl = localStorage.getItem('sheetdb_url');
        let presencaChart = null;

        function inicializar() {
            const saved = localStorage.getItem('dados');
            if (saved) dados = JSON.parse(saved);
            atualizarDashboard();
            console.log('Sistema pronto! Para sincronizar com Google Sheets:');
            console.log('localStorage.setItem("sheetdb_url", "sua_url_aqui");');
        }

        function salvarDados() {
            localStorage.setItem('dados', JSON.stringify(dados));
            atualizarDashboard();
        }

        function adicionarLider(e) {
            e.preventDefault();
            const lider = {
                id: Date.now(),
                nome: document.getElementById('nomeLider').value,
                email: document.getElementById('emailLider').value,
                telefone: document.getElementById('telefoneLider').value,
                dataInicio: document.getElementById('dataInicioLider').value
            };
            dados.lideres.push(lider);
            salvarDados();
            mostrarAlerta('âœ… LÃ­der adicionado!', 'success');
            fecharModal('modalAdicionar');
            document.querySelector('#modalAdicionar form').reset();
        }

        function adicionarReuniao(e) {
            e.preventDefault();
            const reuniao = {
                id: Date.now(),
                data: document.getElementById('dataReuniao').value,
                lider: parseInt(document.getElementById('liderReuniao').value),
                presente: document.getElementById('presenteReuniao').value
            };
            dados.reunioes.push(reuniao);
            salvarDados();
            mostrarAlerta('âœ… ReuniÃ£o registrada!', 'success');
            fecharModal('modalReuniao');
            document.querySelector('#modalReuniao form').reset();
        }

        function sincronizarGoogle() {
            if (!sheetdbUrl) {
                mostrarAlerta('Configure a URL primeiro: localStorage.setItem("sheetdb_url", "sua_url")', 'error');
                return;
            }
            
            mostrarAlerta('Sincronizando...', 'success');
            let enviados = 0;
            
            dados.lideres.forEach((lider, i) => {
                setTimeout(() => {
                    fetch(sheetdbUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(lider)
                    })
                    .then(r => r.json())
                    .then(d => {
                        if (d.success) enviados++;
                        if (i === dados.lideres.length - 1) {
                            mostrarAlerta('âœ… ' + enviados + ' lÃ­deres sincronizados!', 'success');
                        }
                    })
                    .catch(e => console.error(e));
                }, i * 300);
            });
        }

        function importarCSV(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const csv = e.target.result;
                const linhas = csv.split('\n');
                const headers = linhas[0].split(',').map(h => h.trim().toLowerCase());

                for (let i = 1; i < linhas.length; i++) {
                    if (!linhas[i].trim()) continue;
                    const valores = linhas[i].split(',').map(v => v.trim());
                    
                    const lider = {
                        id: Date.now() + i,
                        nome: valores[headers.indexOf('nome')] || '',
                        email: valores[headers.indexOf('email')] || '',
                        telefone: valores[headers.indexOf('telefone')] || '',
                        dataInicio: valores[headers.indexOf('datainicio')] || ''
                    };

                    if (lider.nome) dados.lideres.push(lider);
                }

                salvarDados();
                mostrarAlerta('âœ… ' + (linhas.length - 1) + ' lÃ­deres importados!', 'success');
                fecharModal('modalImportar');
                document.getElementById('csvFile').value = '';
            };
            reader.readAsText(file);
        }

        function exportarCSV() {
            let csv = 'Nome,Email,Telefone,Data Inicio\n';
            dados.lideres.forEach(l => {
                csv += `"${l.nome}","${l.email}","${l.telefone}","${l.dataInicio}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lideres.csv';
            a.click();
        }

        function atualizarDashboard() {
            document.getElementById('totalLideres').textContent = dados.lideres.length;
            document.getElementById('totalReunioes').textContent = dados.reunioes.length;

            if (dados.reunioes.length > 0) {
                const presentes = dados.reunioes.filter(r => r.presente === 'sim').length;
                const media = Math.round((presentes / dados.reunioes.length) * 100);
                document.getElementById('presencaMedia').textContent = media + '%';
            }

            let html = '';
            dados.lideres.forEach(l => {
                const reunioesLider = dados.reunioes.filter(r => r.lider === l.id);
                const presentes = reunioesLider.filter(r => r.presente === 'sim').length;
                const presenca = reunioesLider.length > 0 ? Math.round((presentes / reunioesLider.length) * 100) : 0;
                html += `<div style="padding: 10px; border-bottom: 1px solid #eee;">
                    <strong>${l.nome}</strong> - ${presenca}% (${presentes}/${reunioesLider.length})
                </div>`;
            });
            document.getElementById('lidereslista').innerHTML = html || '<div class="empty">Nenhum lÃ­der</div>';

            let options = '<option value="">Selecione</option>';
            dados.lideres.forEach(l => {
                options += `<option value="${l.id}">${l.nome}</option>`;
            });
            document.getElementById('liderReuniao').innerHTML = options;

            if (sheetdbUrl) {
                document.getElementById('statusSync').innerHTML = 'âœ… Conectado';
            } else {
                document.getElementById('statusSync').innerHTML = 'âš ï¸ NÃ£o configurado';
            }

            atualizarGrafico();
        }

        function atualizarGrafico() {
            const ctx = document.getElementById('presencaChart').getContext('2d');
            const labels = dados.lideres.map(l => l.nome);
            const presencas = dados.lideres.map(l => {
                const reunioesLider = dados.reunioes.filter(r => r.lider === l.id);
                const presentes = reunioesLider.filter(r => r.presente === 'sim').length;
                return reunioesLider.length > 0 ? Math.round((presentes / reunioesLider.length) * 100) : 0;
            });

            if (presencaChart) presencaChart.destroy();
            presencaChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'PresenÃ§a (%)',
                        data: presencas,
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });
        }

        function abrirModal(id) { document.getElementById(id).classList.add('active'); }
        function fecharModal(id) { document.getElementById(id).classList.remove('active'); }
        function mostrarAlerta(msg, tipo) {
            const alerta = document.getElementById('alerta');
            alerta.textContent = msg;
            alerta.className = 'alert active ' + tipo;
            setTimeout(() => alerta.classList.remove('active'), 3000);
        }

        inicializar();
    </script>
</body>
</html>
